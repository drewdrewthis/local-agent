#!/bin/bash
# Encrypt sensitive files for git storage
# Usage: ./scripts/secrets/encrypt

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)"
SECRETS_DIR="$PROJECT_ROOT/secrets"

mkdir -p "$SECRETS_DIR"

# Files to encrypt (source -> encrypted name)
FILES=(
    ".env:env.age"
    "agent-notes/life-context.md:life-context.md.age"
)

echo "Encrypting sensitive files..."
echo "You'll be prompted for a password (use the same one for all files)"
echo ""

for entry in "${FILES[@]}"; do
    src="${entry%%:*}"
    dest="${entry##*:}"

    if [[ -f "$PROJECT_ROOT/$src" ]]; then
        echo "Encrypting $src -> secrets/$dest"
        age -p "$PROJECT_ROOT/$src" > "$SECRETS_DIR/$dest"
    else
        echo "Skipping $src (not found)"
    fi
done

echo ""
echo "Done. Encrypted files are in secrets/"
echo "These can be safely committed to git."
